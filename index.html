<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Zsynchronizowany Arkusz Danych</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f0f2f5; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .nav { display: flex; gap: 10px; margin-bottom: 20px; }
        #pasteArea { width: 100%; height: 80px; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; color: #666; cursor: pointer; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #007bff; color: white; }
        button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-save { background: #28a745; color: white; }
        .btn-load { background: #007bff; color: white; }
    </style>
</head>
<body>

<div class="container">
    <h2>Mój Zdalny Arkusz</h2>
    <div class="nav">
        <button class="btn-save" onclick="saveToCloud()">ZAPISZ W CHMURZE</button>
        <button class="btn-load" onclick="loadFromCloud()">POBIERZ Z CHMURY</button>
        <span id="status" style="margin-left: 10px; line-height: 40px;">Gotowy.</span>
    </div>

    <div id="pasteArea">Kliknij tutaj i wklej dane (Ctrl+V)</div>

    <table id="dataTable">
        <thead id="headerRow"></thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
    // --- KONFIGURACJA SUPABASE ---
    const SUPABASE_URL = 'https://kvttfueeiccggwrlzuyj.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt2dHRmdWVlaWNjZ2d3cmx6dXlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4NDI4MTMsImV4cCI6MjA4NDQxODgxM30.3P5LPIV1kH7NyJfYcaEqwMt9g4sn4IUdkFzaRcQI5dQ';

    let currentRawData = "";

    // Wklejanie danych
    document.addEventListener('paste', (e) => {
        const data = (e.clipboardData || window.clipboardData).getData('Text');
        currentRawData = data;
        renderTable(data);
    });

    function renderTable(data) {
        const rows = data.trim().split(/\r\n|\n/);
        const tableBody = document.getElementById('tableBody');
        const headerRow = document.getElementById('headerRow');
        tableBody.innerHTML = '';
        headerRow.innerHTML = '';

        rows.forEach((row, index) => {
            const cols = row.split('\t');
            const tr = document.createElement('tr');
            cols.forEach(col => {
                const cell = index === 0 ? document.createElement('th') : document.createElement('td');
                cell.innerText = col;
                tr.appendChild(cell);
            });
            if (index === 0) headerRow.appendChild(tr);
            else tableBody.appendChild(tr);
        });
    }

    // Zapisywanie do chmury
    async function saveToCloud() {
        if (!currentRawData) return alert("Brak danych do zapisu!");
        document.getElementById('status').innerText = "Zapisywanie...";
        
        const response = await fetch(`${SUPABASE_URL}/rest/v1/dane_excel`, {
            method: 'POST',
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`,
                'Content-Type': 'application/json',
                'Prefer': 'return=representation'
            },
            body: JSON.stringify({ content: currentRawData })
        });

        if (response.ok) document.getElementById('status').innerText = "Zapisano pomyślnie!";
        else document.getElementById('status').innerText = "Błąd zapisu.";
    }

    // Pobieranie z chmury
    async function loadFromCloud() {
        document.getElementById('status').innerText = "Pobieranie...";
        const response = await fetch(`${SUPABASE_URL}/rest/v1/dane_excel?order=created_at.desc&limit=1`, {
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`
            }
        });
        const data = await response.json();
        if (data.length > 0) {
            currentRawData = data[0].content;
            renderTable(currentRawData);
            document.getElementById('status').innerText = "Dane załadowane!";
        } else {
            document.getElementById('status').innerText = "Baza jest pusta.";
        }
    }
</script>
</body>
</html>
